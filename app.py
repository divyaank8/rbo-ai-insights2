
# RBO 2

rm_daily_nudge_rbo3 = """
🏦 RM Daily Nudge – RBO-3

🎉 Congratulations! 🏆  
Your Region is ranked 2nd in your AO (out of 5 RBOs), 3rd in your Network, and 6th in your Circle.  
Your team has shown strong, consistent performance this month, maintaining steady CASA (89%) and Loan (65%) MTD budget achievements. However, the rising NPA trend (+18 bps) needs your urgent attention.

📈 Performance Overview  
💰 Deposits: You're at the highest budget achievement in your AO and Network.  
⬆️ Advances: Achievements are close to being on track and should reach targets.  
⚠️ NPA: The increase is a concern and is above the peer average.  
⚙️ Operational: A few branches have shown operational lapses.  

📌 Suggested Focus  
✅ Maintain momentum in CASA and Loans.  
🚨 Aggressively tackle operational/compliance issues and NPA management.  

🌟 Top Performing Branches: New Delhi Main Branch (Parliament Street), Connaught Place  
🔻 Bottom Performing Branches: Saket, Janakpuri, Dwarka Sector 10  
"""

# 📊 Category-wise Deep Dive  

rm_daily_nudge_rbo3_deposits = """

💰 Deposits (CASA)  
MTD: ₹16.02 Cr vs Target ₹18 Cr 🔹 89% Achieved – Strong performance.  
⭐ Top Branches: New Delhi Main, Connaught Place, Daryaganj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Pitam Pura  
📌 Snapshot:  
 • 8 branches <40% budget achievement; 28 branches >75% budget achievement  
 • Persistent Laggards: Badarpur, Connaught Place, Karol Bagh + 3 others  
 • New Declines:  
   • Patel Nagar: Lost major institutional account  
   • Pitam Pura: Salaried accounts moved due to better competitor package  
🛠️ Actions:  
 • Patel Nagar: Review & strengthen institutional client ties  
 • Pitam Pura: Deepen corporate engagement to retain salaried accounts  
 • All Laggards: Run hyper-local campaigns, tailor products to local needs  

"""

rm_daily_nudge_rbo3_advances = """

⬆️ Advances (Total)  
MTD: ₹9.75 Cr vs Target ₹15 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  

💼 SME Loans  
MTD: ₹5.2 Cr vs Target ₹8 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main Branch, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  
📌 Snapshot:  
 • 5 branches <30% budget achievement; 20 >70% budget achievement  
 • Persistent Laggards: Badarpur, Karol Bagh + 2 others  
 • New Issues:  
   • Dwarka Sec-10: High rejection rate (collateral/document gaps)  
   • Patel Nagar: TAT delays, disbursals lagging by 5 days  
🛠️ Actions:  
 • Dwarka: Push CGTMSE-backed options  
 • Patel Nagar: Fast-track high-ticket loans, optimize approval flow  
 • All Laggards: Run cluster-based outreach (e.g., “Loan Melas”), trade body engagement  

🏠 Housing Loans  
MTD: ₹4.88 Cr vs Target ₹7.55 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  
📌 Snapshot:  
 • 6 branches <35% budget achievement  
 • Persistent Laggards: Connaught Place, Laxmi Nagar + 1 (low market demand)  
 • New Issues:  
   • Green Park: Lost key builder tie-up  
   • Tilak Nagar: Competitor edge (rate & speed) → 15% drop in apps  
🛠️ Actions:  
 • Green Park: Re-engage lost builder, pursue new ones  
 • Tilak Nagar: Promote transparent rates (no-hidden charges), simplify process  
 • All Laggards: Run home loan clinics, attend project launches, digitize onboarding  

🚗 Auto Loans  
MTD: ₹2.93 Cr vs Target ₹4.5 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  
📌 Snapshot:  
 • 19 branches <40% budget achievement  
 • Key Issues:  
   • Lost key dealership to competitor (better incentives, faster disbursals)  
   • Slower approval → 2-day delay = dealer dissatisfaction  
🛠️ Actions:  
 • Re-engage dealerships, improve incentives, reduce processing time  
 • Train dealers, launch dealer-tier rewards  
 • Deploy on-site loan officers for instant approvals  
"""

rm_daily_nudge_rbo3_ops_npa = """

⚠️ NPA Management  
Current NPA: 1.70% 🔺 +18 bps vs Target 1.52% → ₹1.5 Cr total NPA  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Saket, Narela, Dwarka Sec-10, Connaught Place  
📌 Snapshot:  
 • Saket: High NPA ₹0.18 Cr – recovery/appraisal gaps  
 • Janakpuri: Personal Loan NPA ↑ ₹0.15 Cr  
 • Narela: Agri NPA ↑ ₹0.10 Cr (seasonal)  
 • Connaught Place: NPA% down, but actuals up ₹0.20 Cr – disbursement spike masking risk  
🛠️ Actions:  
 • Rapid reviews, restructure viable cases, recover others  
 • Boost early warning triggers, tighten underwriting  
 • Intensify collections, legal action, post-disbursal checks  

🏧 ATM Availability  
Uptime: 91.5% vs Target 95% → 50 outages across 40 branches 🔺 Target <20  
⭐ Top ATMs: New Delhi Main, Karol Bagh, Civil Lines  
🔻 Bottom ATMs: Laxmi Nagar, Uttam Nagar  
📌 Snapshot:  
 • Laxmi Nagar: 15 outages – poor connectivity, old hardware  
 • Sarojini Nagar, Shastri Nagar: Major cash-outs due to poor forecasting  
🛠️ Actions:  
 • Use volume-based forecasting for cash replenishment  
 • Audit & upgrade outdated ATMs  
 • Strengthen monitoring, review vendor for strict adherence to service  

"""
# RBO 2

rm_daily_nudge_rbo1 = """
🏦 RM Daily Nudge – RBO-1

🎉 Congratulations! 🏆  
Your Region is ranked 2nd in your AO (out of 5 RBOs), 3rd in your Network, and 6th in your Circle.  
Your team has shown strong, consistent performance this month, maintaining steady CASA (89%) and Loan (65%) MTD budget achievements. However, the rising NPA trend (+18 bps) needs your urgent attention.

📈 Performance Overview  
💰 Deposits: You're at the highest budget achievement in your AO and Network.  
⬆️ Advances: Achievements are close to being on track and should reach targets.  
⚠️ NPA: The increase is a concern and is above the peer average.  
⚙️ Operational: A few branches have shown operational lapses.  

📌 Suggested Focus  
✅ Maintain momentum in CASA and Loans.  
🚨 Aggressively tackle operational/compliance issues and NPA management.  

🌟 Top Performing Branches: New Delhi Main Branch (Parliament Street), Connaught Place  
🔻 Bottom Performing Branches: Saket, Janakpuri, Dwarka Sector 10  
"""

# 📊 Category-wise Deep Dive  

rm_daily_nudge_rbo1_deposits = """

💰 Deposits (CASA)  
MTD: ₹16.02 Cr vs Target ₹18 Cr 🔹 89% Achieved – Strong performance.  
⭐ Top Branches: New Delhi Main, Connaught Place, Daryaganj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Pitam Pura  
📌 Snapshot:  
 • 8 branches <40% budget achievement; 28 branches >75% budget achievement  
 • Persistent Laggards: Badarpur, Connaught Place, Karol Bagh + 3 others  
 • New Declines:  
   • Patel Nagar: Lost major institutional account  
   • Pitam Pura: Salaried accounts moved due to better competitor package  
🛠️ Actions:  
 • Patel Nagar: Review & strengthen institutional client ties  
 • Pitam Pura: Deepen corporate engagement to retain salaried accounts  
 • All Laggards: Run hyper-local campaigns, tailor products to local needs  

"""

rm_daily_nudge_rbo1_advances = """

⬆️ Advances (Total)  
MTD: ₹9.75 Cr vs Target ₹15 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  

💼 SME Loans  
MTD: ₹5.2 Cr vs Target ₹8 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main Branch, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  
📌 Snapshot:  
 • 5 branches <30% budget achievement; 20 >70% budget achievement  
 • Persistent Laggards: Badarpur, Karol Bagh + 2 others  
 • New Issues:  
   • Dwarka Sec-10: High rejection rate (collateral/document gaps)  
   • Patel Nagar: TAT delays, disbursals lagging by 5 days  
🛠️ Actions:  
 • Dwarka: Push CGTMSE-backed options  
 • Patel Nagar: Fast-track high-ticket loans, optimize approval flow  
 • All Laggards: Run cluster-based outreach (e.g., “Loan Melas”), trade body engagement  

🏠 Housing Loans  
MTD: ₹4.88 Cr vs Target ₹7.55 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  
📌 Snapshot:  
 • 6 branches <35% budget achievement  
 • Persistent Laggards: Connaught Place, Laxmi Nagar + 1 (low market demand)  
 • New Issues:  
   • Green Park: Lost key builder tie-up  
   • Tilak Nagar: Competitor edge (rate & speed) → 15% drop in apps  
🛠️ Actions:  
 • Green Park: Re-engage lost builder, pursue new ones  
 • Tilak Nagar: Promote transparent rates (no-hidden charges), simplify process  
 • All Laggards: Run home loan clinics, attend project launches, digitize onboarding  

🚗 Auto Loans  
MTD: ₹2.93 Cr vs Target ₹4.5 Cr 🔹 65% Achieved  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Badarpur, Connaught Place, Karol Bagh, Patel Nagar, Dwarka Sec-10  
📌 Snapshot:  
 • 19 branches <40% budget achievement  
 • Key Issues:  
   • Lost key dealership to competitor (better incentives, faster disbursals)  
   • Slower approval → 2-day delay = dealer dissatisfaction  
🛠️ Actions:  
 • Re-engage dealerships, improve incentives, reduce processing time  
 • Train dealers, launch dealer-tier rewards  
 • Deploy on-site loan officers for instant approvals  
"""

rm_daily_nudge_rbo1_ops_npa = """

⚠️ NPA Management  
Current NPA: 1.70% 🔺 +18 bps vs Target 1.52% → ₹1.5 Cr total NPA  
⭐ Top Branches: New Delhi Main, Rohini Sec-7, Vasant Kunj  
🔻 Bottom Branches: Saket, Narela, Dwarka Sec-10, Connaught Place  
📌 Snapshot:  
 • Saket: High NPA ₹0.18 Cr – recovery/appraisal gaps  
 • Janakpuri: Personal Loan NPA ↑ ₹0.15 Cr  
 • Narela: Agri NPA ↑ ₹0.10 Cr (seasonal)  
 • Connaught Place: NPA% down, but actuals up ₹0.20 Cr – disbursement spike masking risk  
🛠️ Actions:  
 • Rapid reviews, restructure viable cases, recover others  
 • Boost early warning triggers, tighten underwriting  
 • Intensify collections, legal action, post-disbursal checks  

🏧 ATM Availability  
Uptime: 91.5% vs Target 95% → 50 outages across 40 branches 🔺 Target <20  
⭐ Top ATMs: New Delhi Main, Karol Bagh, Civil Lines  
🔻 Bottom ATMs: Laxmi Nagar, Uttam Nagar  
📌 Snapshot:  
 • Laxmi Nagar: 15 outages – poor connectivity, old hardware  
 • Sarojini Nagar, Shastri Nagar: Major cash-outs due to poor forecasting  
🛠️ Actions:  
 • Use volume-based forecasting for cash replenishment  
 • Audit & upgrade outdated ATMs  
 • Strengthen monitoring, review vendor for strict adherence to service  

"""
# Dictionary mapping for easy handling
rbo_summaries = {
    "RBO-1": rm_daily_nudge_rbo1,
    # "RBO-2": rm_daily_nudge_rbo2,
    "RBO-3": rm_daily_nudge_rbo3,
}

rbo_deep_dives = {
    "RBO-3": {
        "Deposits": rm_daily_nudge_rbo3_deposits,
        "Advances": rm_daily_nudge_rbo3_advances,
        "NPA & Ops": rm_daily_nudge_rbo3_ops_npa,
    },
        "RBO-1": {
        "Deposits": rm_daily_nudge_rbo1_deposits,
        "Advances": rm_daily_nudge_rbo1_advances,
        "NPA & Ops": rm_daily_nudge_rbo1_ops_npa,
    }
    # You can add "RBO-1": {...} and "RBO-2": {...} as needed
}

import streamlit as st

# ✅ Must be the first Streamlit command
st.set_page_config(page_title="RBOgen AI – SBI Regional Insights", layout="wide")

# 🎨 SBI Color Theme
SBI_BLUE = "#002f6c"
SBI_ACCENT = "#0078d7"
SBI_BG = "#ece5dd"           # WhatsApp-like background
USER_MSG_BG = "#dcf8c6"      # Outgoing (user) messages
BOT_MSG_BG = "#ffffff"       # Incoming (bot) messages
CHAT_BORDER = "#d0d0d0"

# 🔧 Custom CSS Styling
st.markdown(f"""
<style>
    /* Main Background */
    .stApp {{
        background-color: {SBI_BG};
        font-family: 'Segoe UI', sans-serif;
    }}

    /* Chat container */
    .chat-container {{
        max-width: 800px;
        margin: auto;
        padding: 1rem;
    }}

    /* Chat bubble styles */
    .user-msg, .bot-msg {{
        padding: 0.75rem 1rem;
        margin: 0.5rem 0;
        border-radius: 15px;
        max-width: 70%;
        font-size: 1rem;
        line-height: 1.4;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }}

    .user-msg {{
        background-color: {USER_MSG_BG};
        margin-left: auto;
        text-align: left;
        border: 1px solid {CHAT_BORDER};
    }}

    .bot-msg {{
        background-color: {BOT_MSG_BG};
        margin-right: auto;
        text-align: left;
        border: 1px solid {CHAT_BORDER};
    }}

    /* Message input box at bottom */
    .stTextInput > div > div > input {{
        background-color: white;
        border: 1px solid {SBI_ACCENT};
        border-radius: 25px;
        padding: 0.6rem 1rem;
        color: {SBI_BLUE};
        font-size: 1rem;
    }}

    /* Headings and prompts */

    .stTitle, h1, h2, h3 {{
        color: {SBI_BLUE};
        }}

.rbo-button-row button {{
        width: 100% !important;
        height: 45px !important;
        font-size: 16px !important;
        white-space: nowrap;
    }}
	

</style>
""", unsafe_allow_html=True)





# Custom CSS for chat bubble styling
st.markdown("""
    <style>
    .chat-container {
        background-color: #e5ddd5;
        padding: 20px;
        border-radius: 10px;
        max-width: 100%;
        margin-bottom: 20px;
    }
    .chat-bubble {
        padding: 12px 16px;
        margin: 10px 0;
        border-radius: 12px;
        max-width: 95%;
        position: relative;
        line-height: 1.5;
        font-size: 15px;
        white-space: pre-wrap;
    }
    .user {
        background-color: #dcf8c6;
        align-self: flex-end;
        margin-left: auto;
    }
    .bot {
        background-color: #ffffff;
        border: 1px solid #ccc;
        align-self: flex-start;
        margin-right: auto;
    }
    .chat-section-title {
        font-size: 18px;
        margin-top: 20px;
        font-weight: bold;
        color: #075e54;
    }


    .whatsapp-header {
        background-color: #ffffff;
        padding: 10px 16px;
        border-bottom: 1px solid #ccc;
        display: flex;
        align-items: center;
    }
    .header-img {
        border-radius: 50%;
        height: 40px;
        margin-right: 12px;
    }
    .header-name {
        font-weight: bold;
        font-size: 16px;
    }
    .header-meta {
        font-size: 13px;
        color: gray;
    }
    .header-verified {
        height: 14px;
        margin-left: 4px;
        vertical-align: middle;
    }
    div.stButton > button {
        min-width: 32% !important;
        max-width: 100% !important;
        height: 30px !important;
        font-size: 12px !important;
        white-space: nowrap;
    }

    </style>
""", unsafe_allow_html=True)












# -------------------------------------------
# 📊 Main UI Layout - WhatsApp Chat Style
# -------------------------------------------

# st.title("📲 RBO IntelliAI")
# st.markdown("##### 💬 GenAI Chat Insights for RBO")


st.markdown("""
<div class="whatsapp-header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/c/cc/SBI-logo.svg" class="header-img">
    <div>
        <div class="header-name">📲 RBO IntelliAI <img src="https://cdn-icons-png.flaticon.com/512/1828/1828640.png" class="header-verified"></div>
        <div class="header-meta">GenAI Chat Insights for RBO</div>
    </div>
</div>
""", unsafe_allow_html=True)
	

# Setup session state to track selected RBO
if "selected_rbo" not in st.session_state:
    st.session_state.selected_rbo = "RBO-1"

rbo_options = ["RBO-1", "RBO-3", "RBO-2"]

if "selected_rbo" not in st.session_state:
    st.session_state.selected_rbo = "RBO-1"
if "loading" not in st.session_state:
    st.session_state.loading = False
if "content_reset" not in st.session_state:
    st.session_state.content_reset = False

def on_rbo_click(rbo):
    if st.session_state.selected_rbo != rbo:
        st.session_state.loading = True
        st.session_state.selected_rbo = rbo
        st.session_state.content_reset = False




# --- RBO Button Row ---



with st.container():

    st.markdown("\n**Select the RBO:**")

    cols = st.columns(len(rbo_options), gap="small")  # Use small gap for tighter spacing
    for i, rbo in enumerate(rbo_options):
        with cols[i]:
            is_selected = st.session_state.selected_rbo == rbo
            button_label = f"{rbo}" if is_selected else rbo
            if st.button(button_label, key=f"btn_{rbo}", use_container_width=True):
                on_rbo_click(rbo)



selected_rbo = st.session_state.selected_rbo

loading_placeholder = st.empty()

if st.session_state.loading:
    with loading_placeholder.container():
        with st.spinner(f"Loading data for {selected_rbo}..."):
            time.sleep(1.5)
            st.session_state.loading = False
            st.session_state.content_reset = True
else:
    loading_placeholder.empty()




if st.session_state.loading:
    with st.spinner(f"Loading data for {selected_rbo}..."):
        time.sleep(1.5)
        st.session_state.loading = False
        st.session_state.content_reset = True




# 💡 Icon mapping for deep dive sections
deep_dive_icons = {
    "Deposits": "💰",
    "Advances": "⬆️",
    "NPA & Ops": "🛠️",
    "NPA": "📉",
    "Cross-Sell & Digital": "📱",
    "Compliance": "✅",
}


# --------------------------------
# 🗂️ RBO Selection Panel
# --------------------------------
with st.container():

    #st.markdown('<div class="chat-section-title">📋 Summary Chat</div>', unsafe_allow_html=True)
    
    st.markdown(f"""
        <div class="chat-container">
            <div class="chat-bubble bot">{rbo_summaries[selected_rbo]}</div>
        </div>
    """, unsafe_allow_html=True)



# --------------------------------
# 🔍 Deep Dive Panel (WhatsApp Style)
# --------------------------------


if selected_rbo in rbo_deep_dives:
    st.markdown('<div class="chat-section-title">Select Segments for more info</div>', unsafe_allow_html=True)

    deep_dive_options = list(rbo_deep_dives[selected_rbo].keys())

    # Initialize session state to track selected deep dives
    if "selected_deep_dives" not in st.session_state:
        st.session_state.selected_deep_dives = []

    cols = st.columns(len(deep_dive_options), gap="small")
    for i, dive in enumerate(deep_dive_options):
        with cols[i]:
            is_selected = dive in st.session_state.selected_deep_dives
            icon = deep_dive_icons.get(dive, "📂")
            label = f"✅ {icon} {dive}" if is_selected else f"{icon} {dive}"

            # Use a button to toggle selection state
            if st.button(label, key=f"btn_deep_{dive}", use_container_width=True):
                if is_selected:
                    st.session_state.selected_deep_dives.remove(dive)
                else:
                    st.session_state.selected_deep_dives.append(dive)

    # Display selected deep dives content
    for dive in st.session_state.selected_deep_dives:
        icon = deep_dive_icons.get(dive, "📂")
        st.markdown(f"""
            <div class="chat-container">
                <div class="chat-bubble user">{icon} {dive}</div>
                <div class="chat-bubble bot">{rbo_deep_dives[selected_rbo][dive]}</div>
            </div>
        """, unsafe_allow_html=True)

else:
    st.warning("🚧 Deep dive insights not yet available for this RBO.")


